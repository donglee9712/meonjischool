<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scroll Star Video</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background-color: #000000;
      }

      div._widget_data {
        background-color: #000000;
      }

      :root {
        --bg-image: url("https://cdn.imweb.me/upload/S20240719b5234893366cf/0f65e3cd98afb.jpg");
        --bg-image-mobile: url("https://cdn.imweb.me/upload/S20240719b5234893366cf/66aada72fe00a.jpg");
        --bg-image-current: var(--bg-image);
        --frame-size: clamp(64px, 12vw, 200px);
      }

      .scroll-video {
        position: relative;
        height: 320vh;
        margin: 0 auto;
        padding: 0;
        max-width: none;
        width: 100vw;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        overflow-x: clip;
      }

      .scroll-video,
      .scroll-video * {
        max-width: 100vw !important;
      }

      .scroll-video__sticky {
        position: sticky;
        top: 0;
        height: 100vh;
        display: grid;
        place-items: center;
        padding: 0;
        overflow: hidden;
        isolation: isolate;
        width: 100%;
      }

      .scroll-video__sticky::before {
        content: "";
        position: absolute;
        inset: 0;
        z-index: -1;
        background: var(--bg-image-current) center center / cover no-repeat;
        background-color: #000000;
      }

      .scroll-video__content {
        display: grid;
        gap: 0;
        justify-items: center;
        width: 100%;
        height: 100%;
      }

      .scroll-video__frame {
        width: var(--frame-size);
        aspect-ratio: 1486 / 1922;
        margin: auto;
        border-radius: 0;
        overflow: hidden;
        background: transparent;
        box-shadow: none;
        transform: translateY(0);
      }

      .scroll-video__media {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: contain;
        object-position: center;
      }

      @media (max-width: 1024px) {
        .scroll-video {
          background-color: #000000;
        }

        .scroll-video__sticky {
          background-color: #000000;
        }

        .scroll-video__sticky::before {
          background-size: 110% 110%;
        }

        :root {
          --bg-image-current: url("https://cdn.imweb.me/upload/S20240719b5234893366cf/2eaba4511de99.jpg");
          --frame-size: clamp(64px, 14vw, 200px);
        }

        .scroll-video__frame {
          transform: translateY(0);
        }
      }

      @media (max-width: 640px) {
        :root {
          --frame-size: clamp(60px, 18vw, 200px);
        }
      }

      
    </style>
  </head>
  <body>
    <section class="scroll-video" aria-label="스크롤 별빛 영상">
      <div class="scroll-video__sticky">
        <div class="scroll-video__content">
          <div class="scroll-video__frame">
            <video class="scroll-video__media" muted playsinline preload="auto">
              <source src="https://donglee9712.github.io/meonjischool/%EB%B3%84%20%EB%8F%99%EC%98%81%EC%83%81/%EB%B3%84%20%EB%8F%99%EC%98%81%EC%83%81.webm" type="video/webm" />
            </video>
          </div>
        </div>
      </div>
    </section>

    <script>
      (function() {
        const section = document.querySelector('.scroll-video');
        const video = section ? section.querySelector('video') : null;
        if (!section || !video) return;

        let targetTime = 0;
        let duration = 0;
        let isActive = true;

        const clamp = (value, min, max) => Math.min(max, Math.max(min, value));
        const hasMetadata = () => Number.isFinite(video.duration) && video.duration > 0;

        const updateTargetFromScroll = () => {
          const rect = section.getBoundingClientRect();
          const scrollable = rect.height - window.innerHeight;
          const progress = scrollable > 0 ? clamp(-rect.top / scrollable, 0, 1) : 0;
          targetTime = progress * duration;
        };

        const handleMetadata = () => {
          duration = hasMetadata() ? video.duration : 0;
          updateTargetFromScroll();
        };

        video.addEventListener('loadedmetadata', handleMetadata);
        video.addEventListener('durationchange', handleMetadata);
        window.addEventListener('scroll', updateTargetFromScroll, { passive: true });
        window.addEventListener('resize', updateTargetFromScroll);

        if ('IntersectionObserver' in window) {
          const activeObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
              isActive = entry.isIntersecting;
            });
          });
          activeObserver.observe(section);
        }

        const render = () => {
          if (isActive && duration && !video.seeking) {
            const delta = Math.abs(video.currentTime - targetTime);
            if (delta > 0.03) {
              video.currentTime = targetTime;
            }
          }
          requestAnimationFrame(render);
        };

        if (video.readyState >= 1) {
          handleMetadata();
        } else {
          video.load();
        }
        updateTargetFromScroll();
        requestAnimationFrame(render);

      })();
    </script>
  </body>
</html>
